# 注册事件、存储事件

调用`enqueuePutListener`函数来处理注册事件。
该函数主要做两部分：`listenTo、enqueue`

### listenTo 注册事件

`总结成一句话：判断docuemnt是否已经注册过该事件，如果没有则进行注册（处理函数为react自己的，而不是我们注册的处理函数）`

首先调用`getListeningForDocument`函数：
会先`docuemnt`节点存储一个`topListenersIDKey`属性，然后向模块的`alreadyListeningTo`对象中存储一个对象，属性 值为`document`的 topListenersIDKey 属性，然后返回该对象。

```js
const alreadyListeningTo = {};
let reactTopListenersCounter = 0;
const topListenersIDKey = "_reactListenersID";

function getListeningForDocument(document) {
  if (!Object.prototype.hasOwnProperty.call(document)) {
    document[topListenersIDKey] = reactTopListenersCounter++;

    alreadyListeningTo[document[topListenersIDKey]] = {};
  }
  return alreadyListeningTo[document[topListenersIDKey]];
}
```

后续操作：
判断`alreadyListeningTo[document[topListenersIDKey]]`对象中是否已经注册过该事件，如果没有注册过该事件，则进行注册，如果该对象中已经有注册过该事件则不会再进行重复注册。
没有注册过的情况
调用`trapBubbledEvent`函数进行注册
向`docuemnt`标签上注册对应事件，事件处理函数为 react 自己的函数（ReactEventListener.dispatchEvent 函数）

最后将`alreadyListeningTo[document[topListenersIDKey]]`对象添加一个属性，属性名为对应事件名，属性值为 true
防止后续的重复注册，主要是为了解决效率问题

```js
if (alreadyListeningTo[document[topListenersIDKey]][事件名]) {
  return;
}

// 调用 trapBubbledEvent 函数进行注册事件

alreadyListeningTo[document[topListenersIDKey]][事件名] = true;
```

### enqueue 存储事件

`总结成一句话：对目标标签注册的事件进行更新，处理函数的this为对应的信息对象`

先向`最外层事务对象中CallbackQueue实例`里存储两个东西：

```js
  事务.callbackQueue : {
      _callback: [], // 存储putListener回调函数
      _conetnt: [] // 存储信息对象
   }
```

`putListener`回调函数
会判断模块中 listenerBank 对象中是否有该属性名为对应事件的属性，如果有则直接获取，如果没有则添加该属性，属性名为注册的事件名、属性值为对象。
向该 listenerBank 对象中对应事件名属性对象中添加一个属性：属性名为虚拟 dom 的 id, 属性值为处理函数

```js
const listenerBank = {};
function putListener(inst, registrationName, listener) {
  const bankForRegistrationName =
    listenerBank[registrationName] || (listenerBank[registrationName] = {});

  bankForRegistrationName[inst._rootNodeID] = listener;
}
```

`信息对象`：
包含： 事件名 如 onClick
事件处理函数
组件初始化实例

当最外层事务进行`close`阶段时：会执行 close 阶段的函数，函数中会遍历该事务里 CallbackQueue 实例存储的\_\_callbacks 数组，数组每一项为`putListener`，然后执行，以完成对事件的存储。

# 事件删除

`执行deleteListener函数进行删除事件`

从模块中的`listenerBank`对象里的对应属性中删除对应的属性（因为属性值为注册的处理函数）

```js
function deleteListener(虚拟dom, 事件名) {
  const bankForRegistrationName = listenerBank[事件名];
  return delete bankForRegistrationName[虚拟dom._];
}
```



# 事件触发

利用事件冒泡来触发绑定在docuemnt身上的事件。处理函数为ReactEventListener.dispatchEvent函数（也就是react自己的函数，也就是ReactEventListener模块的dispatchEvent函数，this为null）

`dispatchEvent`函数： 
   

